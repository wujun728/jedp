(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-52cb"],{"2Xr9":function(e,t,i){"use strict";i.r(t);var a=i("/861"),n=i("QbLZ"),l=i.n(n),s=i("4d7F"),o=i.n(s),r=i("Q3iG"),c=i("CQQS"),u=i("Q7Z5"),d=i("7Qib"),p=i("BzB7"),h=i("OBdy"),m={name:"BusinessApproveFlowCreate",components:{WkBackgroudTabs:r.a,BaseInfoSet:c.a,WkApproveFlow:u.a},filters:{},mixins:[p.a,h.a],props:{isCopy:{type:Boolean,default:!1},detail:Object},data:function(){return{loading:!1,height:document.documentElement.clientHeight-100,tabs:[{label:"1.配置基础信息",value:"base"},{label:"2.配置流程",value:"flow"}],tabIndex:"base",sendNode:{name:"发起人",content:"具有新建权限的员工"},fields:[],fieldsForm:{},fieldsRules:{},flowList:[],conditionFields:null}},computed:{approveFlowConfig:function(){return{conditionSelectRequest:a.j,conditionSelectParams:{label:this.fieldsForm.label},conditionSelectList:3===this.fieldsForm.label?[{fieldId:-1,fieldName:"invoiceMoney",fieldType:1,name:"开票金额",setting:null,type:6},{fieldId:-1,fieldName:"invoiceType",fieldType:1,name:"开票类型",setting:[{label:"增值税专用发票",value:"1"},{label:"增值税普通发票",value:"2"},{label:"国税通用机打发票",value:"3"},{label:"地税通用机打发票",value:"4"},{label:"收据",value:"5"}],type:3}]:null}},examineId:function(){return this.detail?this.detail.examineId:null}},created:function(){this.getBaseField(),this.examineId?this.getFlowList(this.examineId):this.flowList=[Object(d.t)(u.b)]},mounted:function(){var e=this;this.$el.style.zIndex=Object(d.q)(),document.body.appendChild(this.$el),window.onresize=function(){e.height=document.documentElement.clientHeight-100}},destroyed:function(){this.$el&&this.$el.parentNode&&this.$el.parentNode.removeChild(this.$el)},methods:{getFlowList:function(e){var t=this;Object(a.i)({examineId:e}).then(function(e){var i=e.data||[],a=[];t.getListInfo(i,a),t.flowList=a}).catch(function(){})},validateSetting:function(e){this.requestConditionFields().then(function(t){var i=t.find(function(t){return t.fieldName===e.fieldName});e.setting=i?i.setting:[]})},requestConditionFields:function(){var e=this,t=this.approveFlowConfig,i=t.conditionSelectRequest,a=t.conditionSelectParams,n=t.conditionSelectList;return n?o.a.resolve(n):this.conditionFields?o.a.resolve(this.conditionFields):new o.a(function(t,n){i(a).then(function(i){var a=i.data||[];e.conditionFields=a,t(a)}).catch(function(){t([])})})},getBaseField:function(){var e=[];e.push({field:"examineName",formType:"text",isNull:1,name:"审批流名称",setting:[],inputTips:"",value:this.detail?this.detail.examineName:""}),e.push({field:"label",formType:"select",isNull:0,name:"关联对象",setting:[{name:"合同",value:1},{name:"回款",value:2},{name:"发票",value:3},{name:"薪资",value:4},{name:"采购审批",value:5},{name:"采购退货审批",value:6},{name:"销售审批",value:7},{name:"销售退货审批",value:8},{name:"付款审批",value:9},{name:"回款审批",value:10},{name:"盘点审批",value:11},{name:"调拨审批",value:12}],value:this.detail?this.detail.label:1}),e.push({field:"recheckType",formType:"select",isNull:0,name:"审批被拒后重新提交",setting:[{name:"返回审批流初始层级",value:1},{name:"跳过审批流已通过的层级，返回拒绝的层级",value:2}],inputTips:"",value:this.detail?this.detail.recheckType:1}),e.push({field:"managerList",formType:"user",isNull:1,name:"审批流管理员",setting:[],radio:!1,tipType:"tooltip",inputTips:'<div>1、可以在"配置流程"设置当审批人为空，审批<br>自动转交给审批流管理员；当管理员也请假/离<br>职，审批将转交给超级管理员。</div><div>2、可指定多个管理员，审批方式为或签。</div>',value:this.detail?this.detail.managerList:1}),e.push({field:"remarks",formType:"textarea",isNull:0,name:"流程说明",maxlength:200,setting:[],inputTips:"请填写相关注意事项，方便员工在申请时查阅，限制输入200字",value:this.detail?this.detail.remarks:""}),this.handleFields(e)},handleFields:function(e){var t=this,i={},a={};e.forEach(function(e){"userDep"===e.formType?(a.userList=[],a.deptList=[]):(i[e.field]=t.getRules(e),a[e.field]=e.value)}),this.fields=Object(d.t)(e),this.fieldsForm=a,this.fieldsRules=i},formChange:function(e,t,i){"label"===e.field&&(this.flowList=[Object(d.t)(u.b)])},sendClick:function(){var e=this;this.$refs.baseInfoSet.validate().then(function(t){if(t){var i=e.$refs.wkApproveFlow.getParams();if(i.isError)e.$message.error("请完善信息");else{var a=l()({},e.fieldsForm,{dataList:i.list});e.examineId&&!e.isCopy&&(a.examineId=e.examineId),e.submiteRequest(a)}}})},submiteRequest:function(e){var t=this;Object(a.f)(e).then(function(e){t.$message.success("创建成功"),t.$emit("success"),t.closeClick()}).catch(function(){})},closeClick:function(){this.$emit("close")}}},f=(i("FqGB"),i("KHd+")),v=Object(f.a)(m,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("transition",{attrs:{name:"opacity-fade"}},[i("div",{staticClass:"business-approve-flow-create"},[i("wk-backgroud-tabs",{attrs:{options:e.tabs},model:{value:e.tabIndex,callback:function(t){e.tabIndex=t},expression:"tabIndex"}},[i("template",{slot:"right"},[i("el-button",{attrs:{type:"primary"},on:{click:e.sendClick}},[e._v("发布")]),e._v(" "),i("i",{staticClass:"el-icon-close create-close",on:{click:e.closeClick}})],1)],2),e._v(" "),i("base-info-set",{directives:[{name:"show",rawName:"v-show",value:"base"===e.tabIndex,expression:"tabIndex === 'base'"}],ref:"baseInfoSet",attrs:{fields:e.fields,"fields-form":e.fieldsForm,"fields-rules":e.fieldsRules},on:{change:e.formChange}}),e._v(" "),i("wk-approve-flow",{directives:[{name:"show",rawName:"v-show",value:"flow"===e.tabIndex,expression:"tabIndex === 'flow'"}],ref:"wkApproveFlow",attrs:{props:e.approveFlowConfig,list:e.flowList,"send-node":e.sendNode}})],1)])},[],!1,null,"07b2c9f8",null);v.options.__file="Create.vue";var g=v.exports,b=i("9GgJ"),w=i("LrR8"),y={name:"SystemExamine",components:{XrHeader:b.a,BusinessApproveFlowCreate:g,ApprovalFlowUpdateDialog:w.a},mixins:[],data:function(){return{loading:!1,tableHeight:document.documentElement.clientHeight-240,list:[],fieldList:[{prop:"examineName",label:"审批流名称",width:150},{prop:"label",label:"关联对象",width:150},{prop:"recheckType",label:"审批被拒后重新提交",width:150},{prop:"updateUserName",label:"最后修改人",width:150},{prop:"updateTime",label:"最后修改时间",width:150},{prop:"status",label:"状态",width:100}],currentPage:1,pageSize:20,pageSizes:[10,20,30,40],total:0,labelList:[{name:"合同",value:1},{name:"回款",value:2},{name:"发票",value:3},{name:"薪资",value:4},{name:"采购审批",value:5},{name:"采购退货审批",value:6},{name:"销售审批",value:7},{name:"销售退货审批",value:8},{name:"付款审批",value:9},{name:"回款审批",value:10},{name:"盘点审批",value:11},{name:"调拨审批",value:12}],rowDetail:null,isCopyCreate:!1,createShow:!1}},computed:{},mounted:function(){var e=this;window.onresize=function(){e.tableHeight=document.documentElement.clientHeight-240},this.getList()},methods:{getList:function(){var e=this;this.loading=!0,Object(a.k)({page:this.currentPage,limit:this.pageSize}).then(function(t){e.list=t.data.list,e.total=t.data.totalRow,e.loading=!1}).catch(function(){e.loading=!1})},fieldFormatter:function(e,t){if("label"===t.property){var i=this.labelList.find(function(t){return t.value===e.label});return i?i.name:"--"}if("userList"===t.property){var a=(e.deptList||[]).map(function(e){return e.name}).join("、"),n=(e.userList||[]).map(function(e){return e.realname}).join("、");return a&&n&&(a+="、"),a+n||"全公司"}return"status"===t.property?2===e[t.property]?"停用":"启用":"recheckType"===t.property?{1:"返回审批流初始层级",2:"跳过审批流已通过的层级，返回拒绝的层级"}[e[t.property]]:e[t.property]},addExamine:function(){this.isCopyCreate=!1,this.rowDetail=null,this.createShow=!0},handleSizeChange:function(e){this.pageSize=e,this.getList()},handleCurrentChange:function(e){this.currentPage=e,this.getList()},handleClick:function(e,t){var i=this;"edit"===e?(this.isCopyCreate=!1,this.rowDetail=t.row,this.createShow=!0):"delete"===e?this.$confirm("您确定要删除该审批流?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Object(a.m)({examineId:t.row.examineId,status:3}).then(function(e){i.list.splice(t.$index,1),0===i.list.length&&(i.currentPage=i.currentPage-1>0?i.currentPage-1:1),i.getList(),i.$message({type:"success",message:"操作成功"})}).catch(function(){})}).catch(function(){i.$message({type:"info",message:"已取消删除"})}):"change"===e?this.$confirm("您确定要"+(2===t.row.status?"启用":"停用")+"该审批流?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Object(a.m)({examineId:t.row.examineId,status:2===t.row.status?1:2}).then(function(e){i.$message({type:"success",message:"操作成功"}),i.getList()}).catch(function(){})}).catch(function(){i.$message({type:"info",message:"取消操作"})}):"copy"===e&&(this.isCopyCreate=!0,this.rowDetail=t.row,this.createShow=!0)}}},x=(i("Ta39"),Object(f.a)(y,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"main"},[i("xr-header",{attrs:{"icon-class":"wk wk-approve","icon-color":"#FFB940",label:"业务审批流"}}),e._v(" "),i("div",{staticClass:"main-body"},[i("div",{staticClass:"main-table-header"},[i("el-button",{staticClass:"main-table-header-button xr-btn--orange",attrs:{type:"primary",icon:"el-icon-plus"},on:{click:e.addExamine}},[e._v("新建审批流程")])],1),e._v(" "),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"main-table",staticStyle:{width:"100%"},attrs:{id:"examine-table",data:e.list,height:e.tableHeight,"highlight-current-row":""}},[e._l(e.fieldList,function(t,a){return i("el-table-column",{key:a,attrs:{formatter:e.fieldFormatter,prop:t.prop,width:t.width,label:t.label,"show-overflow-tooltip":""}})}),e._v(" "),i("el-table-column"),e._v(" "),i("el-table-column",{attrs:{fixed:"right",label:"操作",width:"250"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{attrs:{type:"text",size:"small"},on:{click:function(i){e.handleClick("edit",t)}}},[e._v("编辑")]),e._v(" "),i("el-button",{attrs:{type:"text",size:"small"},on:{click:function(i){e.handleClick("delete",t)}}},[e._v("删除")]),e._v(" "),i("el-button",{attrs:{type:"text",size:"small"},on:{click:function(i){e.handleClick("change",t)}}},[e._v(e._s(2===t.row.status?"启用":"停用"))]),e._v(" "),i("el-button",{attrs:{type:"text",size:"small"},on:{click:function(i){e.handleClick("copy",t)}}},[e._v("复制并新建")])]}}])})],2),e._v(" "),i("div",{staticClass:"p-contianer"},[i("el-pagination",{staticClass:"p-bar",attrs:{"current-page":e.currentPage,"page-sizes":e.pageSizes,"page-size":e.pageSize,total:e.total,background:"",layout:"prev, pager, next, sizes, total, jumper"},on:{"update:pageSize":function(t){e.pageSize=t},"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1),e._v(" "),e.createShow?i("business-approve-flow-create",{attrs:{detail:e.rowDetail,"is-copy":e.isCopyCreate},on:{success:e.getList,close:function(t){e.createShow=!1}}}):e._e(),e._v(" "),i("approval-flow-update-dialog")],1)},[],!1,null,"48150eaf",null));x.options.__file="index.vue";t.default=x.exports},FqGB:function(e,t,i){"use strict";var a=i("npvV");i.n(a).a},"K/Xp":function(e,t,i){},Ta39:function(e,t,i){"use strict";var a=i("K/Xp");i.n(a).a},npvV:function(e,t,i){}}]);