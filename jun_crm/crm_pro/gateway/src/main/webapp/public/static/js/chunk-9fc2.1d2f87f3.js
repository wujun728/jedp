(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-9fc2"],{"36a/":function(e,t,i){},EIxH:function(e,t,i){"use strict";i.r(t);var n=i("/861"),a=i("QbLZ"),s=i.n(a),o=i("Q3iG"),l=i("CQQS"),r=i("Q7Z5"),c={name:"XhIconPopover",components:{},props:{selectIcon:Object},data:function(){return{showPopover:!1,iconList:[],currentIcon:null}},computed:{},watch:{showPopover:function(e){e&&(this.currentIcon=this.selectIcon)}},mounted:function(){this.getIconList()},beforeDestroy:function(){},methods:{getIconList:function(){for(var e=["l-record","leave","trip","overtime","reimbursement","go-out"],t=1;t<=20;t++)e.push("approval-"+t);for(var i=["#3ABCFB","#00CAAB","#3ABCFB","#FAAD14","#3ABCFB","#FF6033"],n=[],a=0;a<e.length;a++){var s={icon:"wk wk-"+e[a]};s.color=i[a%6],n.push(s)}this.iconList=n},closeClick:function(){this.showPopover=!1},sureClick:function(){this.currentIcon&&(this.showPopover=!1,this.$emit("select",this.currentIcon.icon,this.currentIcon.color))},iconSelect:function(e){this.currentIcon=e}}},u=(i("LxT1"),i("KHd+")),d=Object(u.a)(c,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-popover",{attrs:{width:"335","popper-class":"no-padding-popover",trigger:"click"},model:{value:e.showPopover,callback:function(t){e.showPopover=t},expression:"showPopover"}},[i("div",{staticClass:"main"},[i("div",{staticClass:"main__hd"},[e._v("审批流图标")]),e._v(" "),i("flexbox",{staticClass:"main__bd",attrs:{wrap:"wrap"}},e._l(e.iconList,function(t,n){return i("div",{key:n,staticClass:"icon-list",class:{"is-select":e.currentIcon&&e.currentIcon.icon==t.icon},on:{click:function(i){e.iconSelect(t)}}},[i("div",{staticClass:"icon-list__item",style:{backgroundColor:t.color}},[i("i",{class:t.icon})])])})),e._v(" "),i("div",{staticClass:"main__ft"},[i("el-button",{on:{click:e.closeClick}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:e.sureClick}},[e._v("确 定")])],1)],1),e._v(" "),e._t("reference",null,{slot:"reference"})],2)},[],!1,null,"235d389c",null);d.options.__file="XhIconPopover.vue";var h={name:"XhIconSelect",components:{XhIconPopover:d.exports},props:{value:{type:String,default:""},index:Number,item:Object},data:function(){return{dataValue:""}},computed:{iconColor:function(){var e=this.dataValue.split(",");return e.length>1?e[1]:"#9376FF"},iconClass:function(){var e=this.dataValue.split(",");return e.length>1?e[0]:"wk wk-approve"},selectIcon:function(){var e=this.dataValue.split(",");return e.length>1?{icon:e[0],color:e[1]}:null}},watch:{value:function(e){this.dataValue=e}},mounted:function(){this.dataValue=this.value},beforeDestroy:function(){},methods:{iconSelect:function(e,t){this.dataValue=e+","+t,this.valueChange()},valueChange:function(){this.$emit("value-change",{index:this.index,value:this.dataValue})}}},p=(i("S8oQ"),Object(u.a)(h,function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("div",{staticClass:"header-icon",style:{backgroundColor:this.iconColor}},[t("i",{class:this.iconClass})]),this._v(" "),t("xh-icon-popover",{attrs:{"select-icon":this.selectIcon},on:{select:this.iconSelect}},[t("el-button",{attrs:{slot:"reference",type:"primary",plain:""},slot:"reference"},[this._v("选择图标")])],1)],1)},[],!1,null,"364b9a4a",null));p.options.__file="XhIconSelect.vue";var f=p.exports,m=i("7Qib"),v=i("BzB7"),g=i("OBdy"),b={name:"OaApproveFlowCreate",components:{WkBackgroudTabs:o.a,BaseInfoSet:l.a,WkApproveFlow:r.a,XhIconSelect:f},filters:{},mixins:[v.a,g.a],props:{detail:Object},data:function(){return{loading:!1,height:document.documentElement.clientHeight-100,tabs:[{label:"1.配置基础信息",value:"base"},{label:"2.配置流程",value:"flow"}],tabIndex:"base",fields:[],fieldsForm:{},rangeObj:{},fieldsRules:{},flowList:[]}},computed:{approveFlowConfig:function(){return{conditionSelectRequest:n.j,conditionSelectParams:{label:0,categoryId:this.examineId}}},sendNode:function(){var e=this.rangeObj,t=e.userList,i=(e.deptList||[]).map(function(e){return e.name}),n=(t||[]).map(function(e){return e.realname});return{name:"发起人",content:i.concat(n).join("、")||"全公司"}},examineId:function(){return this.detail?this.detail.examineId:null}},created:function(){this.getBaseField(),this.detail&&(this.rangeObj={userList:this.detail.userList,deptList:this.detail.deptList}),this.examineId?this.getFlowList(this.examineId):this.flowList=[Object(m.t)(r.b)]},mounted:function(){var e=this;this.$el.style.zIndex=Object(m.q)(),document.body.appendChild(this.$el),window.onresize=function(){e.height=document.documentElement.clientHeight-100}},destroyed:function(){this.$el&&this.$el.parentNode&&this.$el.parentNode.removeChild(this.$el)},methods:{getFlowList:function(e){var t=this;Object(n.i)({examineId:e}).then(function(e){var i=e.data||[],n=[];t.getListInfo(i,n),t.flowList=n}).catch(function(){})},getBaseField:function(){var e=[];e.push({field:"examineName",formType:"text",isNull:1,name:"审批类型名称",setting:[],inputTips:"",value:this.detail?this.detail.examineName:""}),e.push({field:"examineIcon",formType:"icon",isNull:1,name:"审批类型图标",setting:[],inputTips:"",value:this.detail?this.detail.examineIcon||"":"wk wk-l-record,#3ABCFB"}),e.push({field:"dept",formType:"userDep",isNull:0,name:"发起人范围",setting:[],inputTips:"默认全公司",value:{userList:this.detail&&this.detail.userList?this.detail.userList.map(function(e){return e.userId}):[],deptList:this.detail&&this.detail.deptList?this.detail.deptList.map(function(e){return e.id}):[]}}),e.push({field:"recheckType",formType:"select",isNull:0,name:"审批被拒后重新提交",setting:[{name:"返回审批流初始层级",value:1},{name:"跳过审批流已通过的层级，返回拒绝的层级",value:2}],inputTips:"",value:this.detail?this.detail.recheckType:1}),e.push({field:"managerList",formType:"user",isNull:1,name:"审批流管理员",setting:[],radio:!1,tipType:"tooltip",inputTips:'<div>1、可以在"配置流程"设置当审批人为空，审批<br>自动转交给审批流管理员；当管理员也请假/离<br>职，审批将转交给超级管理员。</div><div>2、可指定多个管理员，审批方式为或签。</div>',value:this.detail?this.detail.managerList:1}),e.push({field:"remarks",formType:"textarea",isNull:0,name:"审批类型说明",maxlength:200,setting:[],inputTips:"请填写相关注意事项，方便员工在申请时查阅，限制输入200字",value:this.detail?this.detail.remarks:""}),this.handleFields(e)},handleFields:function(e){var t=this,i={},n={};e.forEach(function(e){"userDep"===e.formType?(n.userList=e.value.userList,n.deptList=e.value.deptList):(i[e.field]=t.getRules(e),n[e.field]=e.value)}),this.fields=Object(m.t)(e),this.fieldsForm=n,this.fieldsRules=i},formChange:function(e,t,i){"userDep"===e.formType&&(this.rangeObj=i)},oldChange:function(e,t){this.$set(this.fieldsForm,t.field,e.value),this.$refs.baseInfoSet.form.validateField(t.field)},sendClick:function(){var e=this;this.$refs.baseInfoSet.validate().then(function(t){if(t){var i=e.$refs.wkApproveFlow.getParams();if(i.isError)e.$message.error("请完善信息");else{var n=s()({},e.fieldsForm,{label:0,dataList:i.list});e.examineId&&(n.examineId=e.examineId),e.submiteRequest(n)}}})},submiteRequest:function(e){var t=this;Object(n.f)(e).then(function(e){t.$emit("success"),t.examineId?(t.$message.success("创建成功"),t.closeClick()):t.$confirm("您将继续完成审批表单的创建","创建成功",{showCancelButton:!1,closeOnClickModal:!1,closeOnPressEscape:!1,showClose:!1,confirmButtonText:"确定",type:"warning",callback:function(i){t.closeClick(),"confirm"===i&&t.$router.push({name:"workbenchHandlefield",params:{type:"oa_examine",label:"10",id:e.data.examineId}})}})}).catch(function(){})},closeClick:function(){this.$emit("close")}}},w=(i("ssF9"),Object(u.a)(b,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("transition",{attrs:{name:"opacity-fade"}},[i("div",{staticClass:"business-approve-flow-create"},[i("wk-backgroud-tabs",{attrs:{options:e.tabs},model:{value:e.tabIndex,callback:function(t){e.tabIndex=t},expression:"tabIndex"}},[i("template",{slot:"right"},[i("el-button",{attrs:{type:"primary"},on:{click:e.sendClick}},[e._v("发布")]),e._v(" "),i("i",{staticClass:"el-icon-close create-close",on:{click:e.closeClick}})],1)],2),e._v(" "),i("base-info-set",{directives:[{name:"show",rawName:"v-show",value:"base"===e.tabIndex,expression:"tabIndex === 'base'"}],ref:"baseInfoSet",attrs:{fields:e.fields,"fields-form":e.fieldsForm,"fields-rules":e.fieldsRules},on:{change:e.formChange},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.data;return[n&&"icon"==n.formType?i("xh-icon-select",{attrs:{value:e.fieldsForm[n.field]},on:{"value-change":function(t){e.oldChange(t,n)}}}):e._e()]}}])}),e._v(" "),i("wk-approve-flow",{directives:[{name:"show",rawName:"v-show",value:"flow"===e.tabIndex,expression:"tabIndex === 'flow'"}],ref:"wkApproveFlow",attrs:{props:e.approveFlowConfig,list:e.flowList,"send-node":e.sendNode}})],1)])},[],!1,null,"356b6a38",null));w.options.__file="Create.vue";var x={name:"ExamineManager",components:{OaApproveFlowCreate:w.exports,ApprovalFlowUpdateDialog:i("LrR8").a},data:function(){return{loading:!1,tableHeight:document.documentElement.clientHeight-240,list:[],fieldList:[{prop:"examineName",label:"审批类型名称",width:150},{prop:"userList",label:"发起人范围",width:150},{prop:"recheckType",label:"审批被拒后重新提交",width:150},{prop:"remarks",label:"审批类型说明",width:150},{prop:"updateTime",label:"最后修改时间",width:150},{prop:"status",label:"状态",width:150}],currentPage:1,pageSize:10,pageSizes:[10,20,30,40],total:0,rowDetail:null,createShow:!1}},watch:{},mounted:function(){var e=this;window.onresize=function(){e.tableHeight=document.documentElement.clientHeight-240},this.getList()},methods:{saveSuccess:function(){this.currentPage=1,this.getList()},getList:function(){var e=this;this.loading=!0,Object(n.k)({page:this.currentPage,limit:this.pageSize,label:0}).then(function(t){var i=t.data||{},n=i.list||[];n.forEach(function(e){var t=e.examineIcon?e.examineIcon.split(","):[];t.length>1?(e.iconClass=t[0],e.iconColor=t[1]):(e.iconClass="wk wk-approve",e.iconColor="#9376FF")}),e.list=n,e.total=i.totalRow,e.loading=!1}).catch(function(){e.loading=!1})},fieldFormatter:function(e,t){if("userList"===t.property){var i=(e.deptList||[]).map(function(e){return e.name}).join("、"),n=(e.userList||[]).map(function(e){return e.realname}).join("、");return i&&n&&(i+="、"),i+n||"全公司"}return"status"===t.property?2===e[t.property]?"停用":"启用":"recheckType"===t.property?{1:"返回审批流初始层级",2:"跳过审批流已通过的层级，返回拒绝的层级"}[e[t.property]]:e[t.property]},addExamine:function(){this.rowDetail=null,this.createShow=!0},handleSizeChange:function(e){this.pageSize=e,this.getList()},handleCurrentChange:function(e){this.currentPage=e,this.getList()},handleClick:function(e,t){var i=this;"edit-table"===e?this.$router.push({name:"workbenchHandlefield",params:{type:"oa_examine",label:"10",id:t.row.examineId}}):"edit"===e?(this.rowDetail=t.row,this.createShow=!0):"delete"===e?this.$confirm("您确定要删除该审批流?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){i.loading=!0,Object(n.m)({examineId:t.row.examineId,status:3}).then(function(e){i.list.splice(t.$index,1),0==i.list.length&&(i.currentPage=i.currentPage-1>0?i.currentPage-1:1),i.getList(),i.$message({type:"success",message:"操作成功"}),i.loading=!1}).catch(function(){i.loading=!1})}).catch(function(){i.$message({type:"info",message:"已取消删除"})}):"change"===e&&this.$confirm("您确定要"+(2===t.row.status?"启用":"停用")+"该审批流?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Object(n.m)({examineId:t.row.examineId,status:2===t.row.status?1:2}).then(function(e){i.$message({type:"success",message:"操作成功"}),i.getList()}).catch(function(){})}).catch(function(){i.$message({type:"info",message:"已取消删除"})})}}},k=(i("K7xA"),Object(u.a)(x,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("div",{staticClass:"se-table-header"},[i("el-button",{staticClass:"se-table-header-button xr-btn--orange",attrs:{type:"primary",icon:"el-icon-plus"},on:{click:e.addExamine}},[e._v("新建审批流程")])],1),e._v(" "),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"main-table",staticStyle:{width:"100%"},attrs:{id:"examine-table",data:e.list,height:e.tableHeight,stripe:"","highlight-current-row":""}},[i("el-table-column",{attrs:{width:"100",label:"审批流图标"},scopedSlots:e._u([{key:"default",fn:function(e){return[i("div",{staticClass:"table-icon",style:{backgroundColor:e.row.iconColor}},[i("i",{class:e.row.iconClass})])]}}])}),e._v(" "),e._l(e.fieldList,function(t,n){return i("el-table-column",{key:n,attrs:{formatter:e.fieldFormatter,prop:t.prop,width:t.width,label:t.label,"show-overflow-tooltip":""}})}),e._v(" "),i("el-table-column"),e._v(" "),i("el-table-column",{attrs:{fixed:"right",label:"操作",width:"250"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{attrs:{type:"text",size:"small"},on:{click:function(i){e.handleClick("edit-table",t)}}},[e._v("编辑表单")]),e._v(" "),i("el-button",{attrs:{type:"text",size:"small"},on:{click:function(i){e.handleClick("edit",t)}}},[e._v("编辑")]),e._v(" "),i("el-button",{attrs:{disabled:1===t.row.isSys,type:"text",size:"small"},on:{click:function(i){e.handleClick("delete",t)}}},[e._v("删除")]),e._v(" "),i("el-button",{attrs:{type:"text",size:"small"},on:{click:function(i){e.handleClick("change",t)}}},[e._v(e._s(2===t.row.status?"启用":"停用"))])]}}])})],2),e._v(" "),i("div",{staticClass:"p-contianer"},[i("el-pagination",{staticClass:"p-bar",attrs:{"current-page":e.currentPage,"page-sizes":e.pageSizes,"page-size":e.pageSize,total:e.total,background:"",layout:"prev, pager, next, sizes, total, jumper"},on:{"update:pageSize":function(t){e.pageSize=t},"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),e.createShow?i("oa-approve-flow-create",{attrs:{detail:e.rowDetail},on:{success:e.saveSuccess,close:function(t){e.createShow=!1}}}):e._e(),e._v(" "),i("approval-flow-update-dialog")],1)},[],!1,null,"e2447f54",null));k.options.__file="ExamineManager.vue";var C={components:{ExamineManager:k.exports,XrHeader:i("9GgJ").a},data:function(){return{leftType:"ExamineManager",leftSides:[{name:"审批类型管理",type:"ExamineManager"}]}},mounted:function(){},methods:{}},_=(i("RSe2"),Object(u.a)(C,function(){var e=this.$createElement,t=this._self._c||e;return t("flexbox",{staticClass:"main",attrs:{direction:"column",align:"stretch"}},[t("xr-header",{attrs:{"icon-class":"wk wk-workbench","icon-color":"#5864FF",label:"办公审批流"}}),this._v(" "),t("div",{staticClass:"main__bd"},[t(this.leftType,{tag:"component"})],1)],1)},[],!1,null,"dbc33d4c",null));_.options.__file="index.vue";t.default=_.exports},EUMr:function(e,t,i){},K7xA:function(e,t,i){"use strict";var n=i("mfwk");i.n(n).a},LxT1:function(e,t,i){"use strict";var n=i("EUMr");i.n(n).a},RSe2:function(e,t,i){"use strict";var n=i("36a/");i.n(n).a},S8oQ:function(e,t,i){"use strict";var n=i("zERe");i.n(n).a},kYVz:function(e,t,i){},mfwk:function(e,t,i){},ssF9:function(e,t,i){"use strict";var n=i("kYVz");i.n(n).a},zERe:function(e,t,i){}}]);