var roneTabs=new Array();var tabPanel=null;var mainIframe=null;var tabConfig=window.top.tabConfig;var currentTab=null;var currentR1Tab=null;var menu=null;var Global=top.Global;var TargetTab=window.top.TargetTab;var NavFirst=window.top.NavFirst;var NavShow=window.top.NavShow;var OpenType=window.top.OpenType;var I18N=window.top.I18N;Array.prototype.remove=function(a){for(var b=0;b<this.length;b++){if(this[b].tabId==a){this[b]=null;this.splice(b,1);break}}};function getCookie(b){var a=document.cookie.match(new RegExp("(^| )"+b+"=([^;]*)(;|$)"));if(a!=null){return unescape(a[2])}return null}function updateRoneTabs(b){for(var a=0;a<roneTabs.length;a++){if(roneTabs[a].tabId==b.tabId){b.ifrId=roneTabs[a].ifrId;b.ifrName=roneTabs[a].ifrName;b._mgid=roneTabs[a]._mgid;b._mid=roneTabs[a]._mid;roneTabs[a]=b;break}}}function updateSearchSrc(a,c){if(tabConfig.isTab){for(var b=0;b<roneTabs.length;b++){if(roneTabs[b].tabId==a){roneTabs[b].leftFrame.search_src=c;break}}}}function updateSearchTabSrc(a,c){for(var b=0;b<roneTabs.length;b++){if(roneTabs[b].tabId==a){roneTabs[b].leftFrame.search_tabSrc=c;break}}}function RoneTab(f,c,e,d,b,a){if(!d||d==""){d="ro"}this.id=f;this.tabId="tab_"+d+"_"+f;this.tabText=c;this.src=e;this.menugId=d;this.openType=b;this.targetTab=a;this.leftFrame=new LeftFrame();this.openFromMg=false;this.hiddenMenu=false;this.ifrId="ifr-"+this.tabId;this.leftAction=true;this.menuAction=true;this.saveCurrentMenu=function(){var h=window.top.CurrentMenu;this.currentMenu=new Object();for(var g in h){this.currentMenu[g]=h[g]}window.top.setSataus()};this.setCurrentMenu=function(){if(this.currentMenu){window.top.CurrentMenu=this.currentMenu}};this.getIfrName=function(){if(this.ifrName){return this.ifrName}else{return this.ifrId}}}function LeftFrame(i,e,h,g,k,j,f,b,d,l,a,c){this.firstShow=i;this.navShow=e;this.targetTab=h;this.fun_muuid=g;this.fun_src=k;this.fun_title=j;this.nav_src=f;this.nav_tabSrc=b;this.nav_title=d;this.search_src=l;this.search_tabSrc=a;this.search_title=c}function isInRoneTabs(b){if(roneTabs!=null&&roneTabs.length>0){for(var a=0;a<roneTabs.length;a++){if(b.tabId==roneTabs[a].tabId){return true}}}return false}function getRoneTabById(a){if(roneTabs!=null&&roneTabs.length>0){for(var b=0;b<roneTabs.length;b++){if(a==roneTabs[b].tabId){return roneTabs[b]}}}return null}function addTab(c){var b;if(!tabPanel){if(mainIframe){Ext.get(mainIframe).remove()}tabPanel=new Ext.TabPanel({applyTo:"tabcontent",resizeTabs:true,monitorResize:true,minTabWidth:100,tabWidth:125,tabPosition:tabConfig.tabPosition,enableTabScroll:tabConfig.tabPosition=="top"?true:false,plain:true,defaults:{autoScroll:true}})}if(!c.ifrName){c.ifrName=c.ifrId}var a=new Ext.Panel({id:c.tabId,title:c.tabText,iconCls:"tabs",html:'<iframe id="'+c.ifrId+'" name="'+c.ifrName+'"  src="'+tabConfig.blankSrc+'" style="width:100%;height:100%" frameBorder="0" scrolling="auto"></iframe>',closable:true});b=tabPanel.add(a);tabPanel.on("contextmenu",tabContextmenu);a.on("activate",function(){var d=tabPanel.getActiveTab().id;c.tabId=d;doActive(c,tabConfig.refreshOnActive);d=null});a.on("beforedestroy",function(e){roneTabs.remove(e.id);var d=document.getElementById("ifr-"+e.id);if(d){d.src=tabConfig.blankSrc}tabPanel.remove(e.id,true);tabId=null;gc()});if(c.openType!=OpenType.Tabs){tabPanel.activate(a)}b=null;return true}function syncSize(){if(tabPanel){if(false){tabPanel.syncSize()}else{setTimeout("tabPanel.syncSize();",300)}}}function doActive(d,g){var a=d.tabId;if(a.indexOf("tab_1_1")!=-1){window.top.hidenHeaders()}var d=null;for(var c=0;c<roneTabs.length;c++){if(roneTabs[c].tabId==a){d=roneTabs[c];currentR1Tab=d;if(d.leftAction){window.top.footFrame.left.setLeftFrame(d,g)}var e=document.getElementById(d.ifrId);var f=null;syncSize();if(d.openType==OpenType.Fun){f=d.leftFrame.fun_title;d.leftAction=true;_activeMenus(d);if(d.leftFrame.fun_src){if(d.src==null||g||e.src.indexOf(d.leftFrame.fun_src)==-1){var b=addParams2Url(d.leftFrame.fun_src,d.openType);_loadPage(e,b);d.src=addParams2Url(d.leftFrame.fun_src,d.openType)}}}else{if(d.openType==OpenType.Nav){f=d.leftFrame.nav_title;d.leftAction=true;if(d.src==null||g||e.src.indexOf(d.leftFrame.nav_tabSrc)==-1){if(_loadPage(e,d.leftFrame.nav_tabSrc)){d.src=d.leftFrame.nav_tabSrc}}_activeMenus(d)}else{if(d.openType==OpenType.Search&&d.leftFrame.search_tabSrc){f=d.leftFrame.search_title;d.leftAction=true;_activeMenus(d)}else{f=d.tabText;if(e.src.indexOf(d.src)==-1||g){var b=addParams2Url(d.src,d.openType);_loadPage(e,b)}if(d.menuAction===true){window.top.activeMenu(d.menugId,d.id,d.hiddenMenu)}}}}tabPanel.getItem(d.tabId).setTitle(f);tabPanel.activate(d.tabId);e=null;d.setCurrentMenu();if(d.openType==OpenType.Fun){window.top.MenuAudit.doAudit(window.top.RES_TYPE)}else{window.top.MenuAudit.doAudit(window.top.MODULE_TYPE)}break}}d=null}function _loadPage(c,a){if(isGoodURL(a)){c.src=tabConfig.blankSrc;var b=window.top.footFrame.left.leftFrame;if(Ext.isIE&&b&&(b.navShow==NavShow.ShowFirst||b.navShow==NavShow.NotClose)){setTimeout("document.getElementById(currentR1Tab.ifrId).src='"+a+"'",400)}else{c.src=a}return true}return false}function _activeMenus(a){if(a.menuAction===true){if(!a._mgid){a._mgid=window.top.CurrentMenu.mgid;a._mid=window.top.CurrentMenu.menuId}if(a._mgid){window.top.activeMenu(a._mgid,a._mid,false)}}}function isGoodURL(a){if(!a||a.trim()==""||a=="#"||a=="null"){return false}else{return true}}function tabDebug(a){if(tabConfig.isDebug){alert(a.message)}}function isMaxTabMount(){if(tabPanel!=null&&tabPanel.items.getCount()>=tabConfig.maxTabMount){alert("您打开较多的页面，这样会使您的计算机变慢，请关闭掉一些不用的标签");return true}else{return false}}function showTab(c){if(c.targetTab==TargetTab.Auto){if(!isInRoneTabs(c)){if(!isMaxTabMount()){roneTabs.push(c);addTab(c)}}else{updateRoneTabs(c);doActive(c,true)}}else{if(c.targetTab==TargetTab.Current){if(tabPanel.items.getCount()>0){var a=tabPanel.getActiveTab();c.tabId=a.id;updateRoneTabs(c);doActive(c)}else{if(!isMaxTabMount()){roneTabs.push(c);addTab(c)}}}else{if(c.targetTab==TargetTab.NewOne){if(!isMaxTabMount()){var b=new Date().getTime();c.tabId="tab_"+b;roneTabs.push(c);addTab(c)}}else{alert("param:targetTab error,please use class:TargetTab")}}}c=null;gc()}function tabAlert(a){alert(a)}function tabContextmenu(d,a,c){c.stopEvent();currentTab=a;var b=c.getPoint();if(tabConfig.tabPosition!="top"&&b[1]>133){b[1]=b[1]-133}if(!menu){menu=new Ext.menu.Menu({items:[{text:I18N.tab_set_closeMe,handler:tabClose},{text:I18N.tab_set_closeOthers,handler:tabCloseOthers},{text:I18N.tab_set_closeAll,handler:tabCloseAll},"-",{text:I18N.tab_set_refresh,handler:refresh},{text:I18N.tab_set,menu:{items:['<b style="padding-left:26px">'+I18N.tab_set_position+"</b>",new Ext.menu.CheckItem({id:"tabPosition_top",text:I18N.tab_set_position_top,checked:true,group:"tabPosition",checkHandler:onItemCheck}),new Ext.menu.CheckItem({id:"tabPosition_bottom",text:I18N.tab_set_position_bottom,group:"tabPosition",checkHandler:onItemCheck})]}}]})}menu.showAt(b);return false}function onItemCheck(a){menu.hide(true)}function tabClose(){menu.hide(true);currentTab.fireEvent("beforedestroy",currentTab,{});tabPanel.remove(currentTab.id);currentTab=null;gc()}function tabCloseOthers(){menu.hide(true);if(currentTab){for(var a=roneTabs.length-1;a>=0;a--){if(roneTabs[a].tabId!=currentTab.id){var b=tabPanel.getItem(roneTabs[a].tabId);b.fireEvent("beforedestroy",b,{});tabPanel.remove(b.id)}}}currentTab=null;gc()}function tabCloseAll(){if(menu){menu.hide(true)}if(confirm(I18N.tab_set_toCloseAll)){for(var a=roneTabs.length-1;a>=0;a--){var b=tabPanel.getItem(roneTabs[a].tabId);b.fireEvent("beforedestroy",b,{});tabPanel.remove(b.id)}currentTab=null;gc()}}function refresh(){if(menu){menu.hide(true)}if(currentTab){currentTab.tabId=currentTab.id;doActive(currentR1Tab,true)}}function refreshAll(){if(menu){menu.hide(true)}for(var a=roneTabs.length-1;a>=0;a--){doActive(roneTabs[a],true)}}function forward(a,b){if(tabConfig.isTab){if(a&&currentR1Tab){closeTab(currentR1Tab);var c=getRoneTabById(a);if(c){doActive(c,b)}}else{alert("you should set the tabId so that can open it")}}else{window.top.openTab(a)}}function closeTab(b){if(tabConfig.isTab){if(currentR1Tab){var a=tabPanel.getItem(b.tabId);a.fireEvent("beforedestroy",a,{})}}}function isNull(a){if(!a||typeof a=="undefine"){return true}if(a==""||a=="null"){return true}return false}function addParam2Url(a,c,b){if(isNull(a)){return}a+=(a.indexOf("?")>-1)?"&":"?";a+=c+"="+b;return a}function addParams2Url(b,a){b=addParam2Url(b,"menuType",a);b=addParam2Url(b,"appId",window.top.CurrentApp.appID);b=addParam2Url(b,"mgId",window.top.CurrentMenu.mgid);b=addParam2Url(b,"menuId",window.top.CurrentMenu.menuId);b=addParam2Url(b,"resuuid",window.top.CurrentMenu.resId);return b}function justOpen(b){if(checkIsTimeout()){window.top.timeout();return}if(tabConfig.isTab){showTab(b)}else{if(b.tabId.indexOf("tab_1_1")!=-1){window.top.hidenHeaders()}setTabContentBox();if(!mainIframe){mainIframe=Ext.DomHelper.append(document.getElementById("tabcontent"),{tag:"iframe",id:"mainIframe",frameBorder:0,scrolling:"auto",src:tabConfig.blankSrc,name:"mainFrame",width:"100%",height:"100%"},false);currentR1Tab=new RoneTab();currentR1Tab.tabId="mainIframe";currentR1Tab.ifrId="mainIframe";currentR1Tab.ifrName="mainFrame"}if(b.openType==OpenType.Fun&&isGoodURL(b.leftFrame.fun_src)){var a=b.leftFrame.fun_src;mainIframe.src=addParams2Url(a,b.openType)}else{if(b.openType==OpenType.Nav&&isGoodURL(b.leftFrame.nav_tabSrc)){mainIframe.src=b.leftFrame.nav_tabSrc}else{if(b.openType==OpenType.Search&&isGoodURL(b.leftFrame.nav_tabSrc)){mainIframe.src=b.leftFrame.search_tabSrc}else{if(isGoodURL(b.src)){mainIframe.src=addParams2Url(b.src,b.openType)}_activeMenus(b)}}}if(b.leftAction===true){window.top.footFrame.left.setLeftFrame(b,false)}if(b.openType==OpenType.Fun){window.top.MenuAudit.doAudit(window.top.RES_TYPE)}else{window.top.MenuAudit.doAudit(window.top.MODULE_TYPE)}}b.saveCurrentMenu()}function setTabContentBox(){var a=new Ext.Element(document.getElementById("tabcontent"));if(Ext.isIE){a.applyStyles("margin-top:3px;width:100%;height:100%;")}else{a.applyStyles("margin-top:3px;width:99%;height:100%;")}a.setHeight(document.body.clientHeight-4)}function gc(){if(Ext.isIE){CollectGarbage()}}function openV3Main(){var a=new RoneTab();a.targetTab=TargetTab.Auto;a.menuAction=false;a.leftAction=false;a.tabId="main";a.ifrName="main";a.hideTab=true;justOpen(a)}function activeV3Main(a,c){if(c=="main"){var b=getRoneTabById(a);if(b){if(b.hideTab===true){b.hideTab=false}else{b.leftAction=false;b.menuAction=false;b.tabText=window.top.CurrentMenu.mgName+"-"+window.top.CurrentMenu.menuName;b.leftFrame=window.top.footFrame.left.leftFrame;tabPanel.activate(b.tabId);tabPanel.unhideTabStripItem(b.tabId)}}}}function checkIsTimeout(){if(!Global.sessionTimeOut){Global.sessionTimeOut=getSessionTimeout();Global.lastActiveTime=getTime()}else{if(getTime()-Global.lastActiveTime>Global.sessionTimeOut){Global.sessionTimeOut=getSessionTimeout()}else{Global.lastActiveTime=getTime()}}return Global.sessionTimeOut<0}function getTime(){return new Date().getTime()/1000}function getSessionTimeout(){var a=top.Ext.lib.Ajax.getConnectionObject().conn;a.open("GET",Global.path+"/FunctionTreeServlet?flag=getSessionTimeout",false);a.send(null);return parseInt(a.responseText)};